{% extends "base.html" %}
{% block content %}
  {% if form_success %}
    <div class="toast success">{{ form_success }}</div>
  {% endif %}

  <section class="layout" style="margin-top: 18px;">
    <div class="panel">
      <h3>Inbox</h3>
      <div class="muted">New/parked items. Process when you have a moment.</div>
      <div class="list" style="margin-top: 10px;">
        {% for t in inbox_tasks %}
          <div class="list-item">
            <div>{{ t.verb_noun }}</div>
            <div class="muted">{{ t.when_bucket.value|title }}</div>
            <div class="task-meta">
              {% if t.project %}<span class="pill">{{ t.project.title }}</span>{% endif %}
            </div>
          </div>
        {% else %}
          <div class="muted">Inbox clear.</div>
        {% endfor %}
      </div>
      <div class="cta-row">
        <a class="btn" href="/capture">Quick capture</a>
        <a class="btn ghost" href="/capture/wizard">Guided capture</a>
        <a class="btn ghost" href="/waiting">Waiting On / OPP</a>
      </div>
    </div>

    <div class="panel">
      <h3>Now</h3>
      {% if current_block %}
        <div class="list-item">
          <div>{{ current_block.block_type.value|title }} block</div>
          <div class="muted">
            {{ current_block.start_time }} - {{ current_block.end_time }}
          </div>
          {% if current_block.project %}
            <div class="task-meta"><span class="pill">{{ current_block.project.title }}</span></div>
          {% endif %}
        </div>
      {% else %}
        <div class="muted">No block active right now. Choose your One Thing and a Frog.</div>
      {% endif %}
      <div class="cta-row">
        <a class="btn ghost" href="/ritual/morning">Morning check-in</a>
        <a class="btn ghost" href="/ritual/midday">Midday reset</a>
        <a class="btn ghost" href="/ritual/evening">Evening check-out</a>
      </div>
    </div>

    <div class="panel">
      <h3>Today schedule</h3>
      <div class="muted">Blocks scheduled today.</div>
      <div class="list" style="margin-top: 10px;">
        {% for b in todays_blocks %}
          <div class="list-item">
            <div>{{ b.block_type.value|title }} — {{ b.start_time or 'TBD' }}{% if b.end_time %}–{{ b.end_time }}{% endif %}</div>
            {% if b.project %}
              <div class="task-meta"><span class="pill">{{ b.project.title }}</span></div>
            {% endif %}
          </div>
        {% else %}
          <div class="muted">No blocks yet. Plan some.</div>
        {% endfor %}
      </div>
      <div class="cta-row">
        <a class="btn ghost" href="/blocks">Plan blocks</a>
      </div>
    </div>
  </section>

  <section class="grid" style="margin-top: 16px;">
    <div class="panel">
      <h3>Today tasks</h3>
      <div class="muted">Focus/Frog tasks for Today.</div>
      <div class="list" style="margin-top: 12px;">
        {% for t in today_tasks %}
          <div class="list-item">
            <div>{{ t.verb_noun }}</div>
            <div class="muted">{{ t.description or "No notes yet." }}</div>
            <div class="task-meta">
              {% if t.block_type %}<span class="pill">{{ t.block_type.value }}</span>{% endif %}
              {% if t.frog %}<span class="pill pill--warn">Frog</span>{% endif %}
              {% if t.alignment %}<span class="pill">{{ t.alignment.value }}</span>{% endif %}
            </div>
          </div>
        {% else %}
          <div class="muted">No tasks in Today bucket. Add via Capture.</div>
        {% endfor %}
      </div>
      <div class="cta-row">
        <a class="btn" href="/capture">Quick capture</a>
        <a class="btn ghost" href="/capture/wizard">Guided capture</a>
      </div>
    </div>

    <div class="panel">
      <h3>Today calendar</h3>
      <div class="muted">Timeline for today’s blocks; tasks without times stay in Today list.</div>
      <div class="timeline">
        {% for ev in timeline_events %}
          <div class="timeline-row">
            <div class="timeline-time">
              {% if ev.start %}{{ ev.start }}{% else %}TBD{% endif %}
              {% if ev.end %}–{{ ev.end }}{% endif %}
            </div>
            <div class="timeline-body">
              <div>{{ ev.label }}</div>
              {% if ev.project %}
                <div class="muted">{{ ev.project }}</div>
              {% endif %}
            </div>
          </div>
        {% else %}
          <div class="muted">No timed blocks yet. Add via Plan blocks.</div>
        {% endfor %}
      </div>
      <div class="cta-row">
        <a class="btn ghost" href="/blocks">Schedule</a>
        <a class="btn ghost" href="/weekly">Weekly review</a>
      </div>
    </div>
  </section>
{% endblock %}
